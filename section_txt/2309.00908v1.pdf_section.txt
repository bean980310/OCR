--- ABSTRACT ---
This paper addresses the issue of modifying the visual appearance of videos while preserving their motion. A novel framework, named MagicProp, is proposed, which disentangles the video editing process into two stages: appearance editing and motion-aware appearance propagation. In the first stage, MagicProp selects a single frame from the input video and applies image-editing techniques to modify the content and/or style of the frame. The flexibility of these techniques enables the editing of arbitrary regions within the frame. In the second stage, MagicProp employs the edited frame as an appearance reference and generates the remaining frames using an autoregressive rendering approach. To achieve this, a diffusion-based conditional generation model, called PropDPM, is developed, which synthesizes the target frame by conditioning on the reference appearance, the target motion, and its previous appearance. The autoregressive editing approach ensures temporal consistency in the resulting videos. Overall, MagicProp combines the flexibility of image-editing techniques with the superior temporal consistency of autoregressive modeling, enabling flexible editing of object types and aesthetic styles in arbitrary regions of input videos while maintaining good temporal consistency across frames. Extensive experiments in various video editing scenarios demonstrate the effectiveness of MagicProp. 1
--- INTRODUCTION ---
Content creation often involves video editing, which includes modifying the appearance or adjusting the motion of raw videos [Wu et al., 2023; Kasten et al., 2021; Zhao et al., 2023; Wang et al., 2023]. Filmmakers may need to adjust the exposure, saturation, and contrast of raw videos for better aesthetic *Equal contribution. --- --quality, while advertisers may want to change realistic videos into certain fascinating styles to impress target audiences. This paper addresses the problem of editing videos’ appearance, including changing the content or style locally in a certain spatial region or globally throughout the entire video. Existing works attempt to solve this problem mainly from two perspectives: editing each frame individually via image generation models [Qi et al., 2023; Ceylan et al., 2023; Yang et al., 2023; Khachatryan et al., 2023; Geyer et al., 2023] or modeling the entire video sequence for appearance changing [Ni et al., 2023; Molad et al., 2023; Karras et al., 2023; Kasten et al., 2021; Esser et al., 2023]. Methods based on image models, such as Stable Diffusion [Rombach et al., 2022] and ControlNet [Zhang and Agrawala, 2023], can flexibly modify the content or style of any arbitrary region, but it is challenging to ensure temporal consistency across adjacent frames. To alleviate this issue, some use structure-guided models and cross-frame attention to align color and layout across frames [Zhang and Agrawala, 2023; Qi et al., 2023; Ceylan et al., 2023]. Other methods exploit inter-frame correspondence, such as optical flow, to warp the features of edited frames [Yang et al., 2023; Geyer et al., 2023]. However, the temporal consistency of the edited video is still suboptimal. Instead of using image-based models, researchers have developed many sequence-based models for video generation and editing [Esser et al., 2023; Couairon et al., 2023]. Neural Layered Atlas (NLA) overfits a video first and then edits the learned corresponding Atlas to change the foreground or background [Kasten et al., 2021; Bar-Tal et al., 2022]. NLA-based methods can effectively edit the appearance of videos, but test-time optimization is time- and resource-consuming. Recently, many diffusion-based models have been proposed for structure-aware video generation, such as Gen-[Esser et al., 2023], ControlVideo [Zhao et al., 2023; Chen et al., 2023], and VideoComposer [Wang et al., 2023]. These methods synthesize videos by conditioning on layout sequences such as depth or sketch maps, so that the motion coherence in the resultant video can be ensured. However, the editability and flexibility will be compromised due to the limitation of textual descriptions and the difficulty of user interaction. For instance, when editing a certain part of a given video, text prompts may not precisely localize the region of interest across all frames, and it may be challenging for users to prepare masks for all frames. The trade-off between temporal consistency and editing flexibility inspires us to explore other alternative frameworks for video editing. Motivated by the fact that frames within a video usually share a similar scene, we propose a novel framework, MagicProp, which disentangles video editing into two stages, namely, appearance editing and motion-aware appearance propagation. MagicProp first selects one frame from the given video and edits its appearance. The edited frame is used as the appearance reference in the second stage. Then, MagicProp autoregressively renders the remaining frames by conditioning on the reference frame and the motion sequence (e.g., depth maps of the given video). MagicProp models videos in an autoregressive manner, which guarantees the temporal consistency of the output videos. Additionally, MagicProp uses powerful image diffusion models (optionally with additional masks) for reference editing, allowing for flexible modification of the contents of a local region or the entire video. The most crucial component of MagicProp is an autoregressive conditional image diffusion model that synthesizes the target image under the control of its previous frame, the target depth, and the reference appearance. We design a lightweight adapter to merge and inject the semantic-level and pixel-level information of the reference frame into the image generation process, ensuring that the appearance of the resultant frames aligns well with the reference. During training, we follow the strategy of zero terminal signal-to-noise ratio (SNR) [Lin et al., 2023], which bridges the gap between the noise schedules during training and inference, resulting in better matching of the color and style of generated frames with the reference. We conducted extensive experiments in several video editing scenarios, including local object/background editing and global stylization. The results demonstrate the effectiveness and flexibility of MagicProp. The contributions of MagicProp are three-fold: * We proposed a novel framework, MagicProp, that decouples video editing into appearance editing and motion-aware appearance propagation. ¢ We devised a lightweight adapter to inject class- and pixel-level features into the diffusion model. We also applied the zero-terminal SNR strategy for training. These techniques facilitate the alignment of the appearance. ¢ Extensive experiments demonstrate that MagicProp can flexibly edit any arbitrary region of the given video and generate high-quality results. --- --2
--- RELATED WORK ---
S AND PRELIMINARIES In this section, we first review recent related works on the appearance editing of videos. We categorize them into two groups, i.e., editing a video frame by frame via image models, and modeling the whole frame sequence for editing. Then, we introduce the preliminaries about diffusion probabilistic models and the notation for video editing. 2.1 RELATED WORKS Frame-by-frame Editing Diffusion-based image generation models have achieved great success in image generation and editing tasks [Ho et al., 2020; 2022; Rombach et al., 2022; Blattmann et al., 2023]. The simplest
--- METHOD ---
s based on image models, such as Stable Diffusion [Rombach et al., 2022] and ControlNet [Zhang and Agrawala, 2023], can flexibly modify the content or style of any arbitrary region, but it is challenging to ensure temporal consistency across adjacent frames. To alleviate this issue, some use structure-guided models and cross-frame attention to align color and layout across frames [Zhang and Agrawala, 2023; Qi et al., 2023; Ceylan et al., 2023]. Other methods exploit inter-frame correspondence, such as optical flow, to warp the features of edited frames [Yang et al., 2023; Geyer et al., 2023]. However, the temporal consistency of the edited video is still suboptimal. Instead of using image-based models, researchers have developed many sequence-based models for video generation and editing [Esser et al., 2023; Couairon et al., 2023]. Neural Layered Atlas (NLA) overfits a video first and then edits the learned corresponding Atlas to change the foreground or background [Kasten et al., 2021; Bar-Tal et al., 2022]. NLA-based methods can effectively edit the appearance of videos, but test-time optimization is time- and resource-consuming. Recently, many diffusion-based models have been proposed for structure-aware video generation, such as Gen-[Esser et al., 2023], ControlVideo [Zhao et al., 2023; Chen et al., 2023], and VideoComposer [Wang et al., 2023]. These methods synthesize videos by conditioning on layout sequences such as depth or sketch maps, so that the motion coherence in the resultant video can be ensured. However, the editability and flexibility will be compromised due to the limitation of textual descriptions and the difficulty of user interaction. For instance, when editing a certain part of a given video, text prompts may not precisely localize the region of interest across all frames, and it may be challenging for users to prepare masks for all frames. The trade-off between temporal consistency and editing flexibility inspires us to explore other alternative frameworks for video editing. Motivated by the fact that frames within a video usually share a similar scene, we propose a novel framework, MagicProp, which disentangles video editing into two stages, namely, appearance editing and motion-aware appearance propagation. MagicProp first selects one frame from the given video and edits its appearance. The edited frame is used as the appearance reference in the second stage. Then, MagicProp autoregressively renders the remaining frames by conditioning on the reference frame and the motion sequence (e.g., depth maps of the given video). MagicProp models videos in an autoregressive manner, which guarantees the temporal consistency of the output videos. Additionally, MagicProp uses powerful image diffusion models (optionally with additional masks) for reference editing, allowing for flexible modification of the contents of a local region or the entire video. The most crucial component of MagicProp is an autoregressive conditional image diffusion model that synthesizes the target image under the control of its previous frame, the target depth, and the reference appearance. We design a lightweight adapter to merge and inject the semantic-level and pixel-level information of the reference frame into the image generation process, ensuring that the appearance of the resultant frames aligns well with the reference. During training, we follow the strategy of zero terminal signal-to-noise ratio (SNR) [Lin et al., 2023], which bridges the gap between the noise schedules during training and inference, resulting in better matching of the color and style of generated frames with the reference. We conducted extensive
